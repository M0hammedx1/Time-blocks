<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimePlanner - Mohammed Islam Edition</title>
    
    <!-- Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Cairo', sans-serif; overflow-x: hidden; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #333; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.2s ease-out forwards; }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: scaleIn 0.2s cubic-bezier(0.16, 1, 0.3, 1); }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .dark .glass-panel {
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        /* Print Styles */
        @media print {
            @page { size: A4; margin: 10mm; }
            body { background: white !important; color: black !important; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .glass-panel { background: white !important; border: 1px solid #eee !important; box-shadow: none !important; backdrop-filter: none !important; }
            .print-break { page-break-inside: avoid; }
        }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { trueBlack: '#050505', darkCard: '#121212' },
                    boxShadow: { 'glow': '0 0 15px rgba(var(--theme-color), 0.15)' }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-300 selection:bg-indigo-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Config ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const THEMES = [
            { id: 'indigo', name: 'Ù…Ù„ÙƒÙŠ', primary: 'from-indigo-600 to-violet-600', accent: 'text-indigo-600', ring: 'ring-indigo-500', shadow: 'shadow-indigo-500/30' },
            { id: 'rose', name: 'Ø­ÙŠÙˆÙŠ', primary: 'from-rose-500 to-pink-600', accent: 'text-rose-600', ring: 'ring-rose-500', shadow: 'shadow-rose-500/30' },
            { id: 'emerald', name: 'Ø·Ø¨ÙŠØ¹Ø©', primary: 'from-emerald-500 to-teal-600', accent: 'text-emerald-600', ring: 'ring-emerald-500', shadow: 'shadow-emerald-500/30' },
            { id: 'amber', name: 'Ø¯Ø§ÙÙŠØ¡', primary: 'from-amber-500 to-orange-600', accent: 'text-amber-600', ring: 'ring-amber-500', shadow: 'shadow-amber-500/30' },
            { id: 'sky', name: 'Ø³Ù…Ø§Ø¡', primary: 'from-sky-500 to-blue-600', accent: 'text-sky-600', ring: 'ring-sky-500', shadow: 'shadow-sky-500/30' },
            { id: 'slate', name: 'Ø±Ø³Ù…ÙŠ', primary: 'from-slate-700 to-slate-900', accent: 'text-slate-700', ring: 'ring-slate-500', shadow: 'shadow-slate-500/30' },
        ];

        const CAT_STYLES = [
            { id: 0, bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-600 dark:text-blue-400', border: 'border-blue-500' },
            { id: 1, bg: 'bg-red-100 dark:bg-red-900/30', text: 'text-red-600 dark:text-red-400', border: 'border-red-500' },
            { id: 2, bg: 'bg-emerald-100 dark:bg-emerald-900/30', text: 'text-emerald-600 dark:text-emerald-400', border: 'border-emerald-500' },
            { id: 3, bg: 'bg-violet-100 dark:bg-violet-900/30', text: 'text-violet-600 dark:text-violet-400', border: 'border-violet-500' },
            { id: 4, bg: 'bg-amber-100 dark:bg-amber-900/30', text: 'text-amber-600 dark:text-amber-400', border: 'border-amber-500' },
            { id: 5, bg: 'bg-pink-100 dark:bg-pink-900/30', text: 'text-pink-600 dark:text-pink-400', border: 'border-pink-500' },
        ];

        const ICONS = ['briefcase', 'book-open', 'coffee', 'zap', 'activity', 'users', 'home', 'music', 'code', 'pen-tool', 'sun', 'moon', 'star', 'heart', 'check-circle'];

        const Icon = React.memo(({ name, size = 20, className = "" }) => {
            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
        });

        const App = () => {
            // State
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('mi_tasks')) || []);
            const [categories, setCategories] = useState(() => JSON.parse(localStorage.getItem('mi_cats')) || [
                { id: 'work', label: 'Ø¹Ù…Ù„', styleIdx: 0, icon: 'briefcase' },
                { id: 'learn', label: 'ØªØ·ÙˆÙŠØ±', styleIdx: 3, icon: 'book-open' },
                { id: 'rest', label: 'Ø±Ø§Ø­Ø©', styleIdx: 2, icon: 'coffee' },
            ]);
            const [mainGoal, setMainGoal] = useState(() => localStorage.getItem('mi_goal') || "");
            const [theme, setTheme] = useState(() => THEMES.find(t => t.id === localStorage.getItem('mi_theme')) || THEMES[0]);
            const [darkMode, setDarkMode] = useState(() => localStorage.getItem('mi_dark') === 'true');
            
            // UI
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isTxtModalOpen, setIsTxtModalOpen] = useState(false); // New Text Modal
            const [showThemes, setShowThemes] = useState(false);
            const [currentTask, setCurrentTask] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [formData, setFormData] = useState({ title: '', startTime: '09:00', endTime: '10:00', category: '', notes: '' });

            // Persistence
            useEffect(() => { localStorage.setItem('mi_tasks', JSON.stringify(tasks)); }, [tasks]);
            useEffect(() => { localStorage.setItem('mi_cats', JSON.stringify(categories)); }, [categories]);
            useEffect(() => { localStorage.setItem('mi_goal', mainGoal); }, [mainGoal]);
            useEffect(() => { localStorage.setItem('mi_theme', theme.id); }, [theme]);
            useEffect(() => {
                localStorage.setItem('mi_dark', darkMode);
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [tasks, categories, isModalOpen, isSettingsOpen, isTxtModalOpen, showThemes, theme]);
            useEffect(() => { const interval = setInterval(() => setCurrentTime(new Date()), 60000); return () => clearInterval(interval); }, []);

            // Helpers
            const formatTimeAMPM = (time24) => {
                if (!time24) return "";
                const [h, m] = time24.split(':').map(Number);
                const ampm = h >= 12 ? 'PM' : 'AM';
                const h12 = h % 12 || 12;
                return { time: `${h12}:${m.toString().padStart(2, '0')}`, ampm };
            };

            const formatTimeString = (time24) => {
                const f = formatTimeAMPM(time24);
                return `${f.time} ${f.ampm}`;
            }

            const getDurationMins = (start, end) => {
                const [h1, m1] = start.split(':').map(Number);
                const [h2, m2] = end.split(':').map(Number);
                let totalStart = h1 * 60 + m1;
                let totalEnd = h2 * 60 + m2;
                if (totalEnd < totalStart) totalEnd += 24 * 60;
                return totalEnd - totalStart;
            };

            const formatDuration = (mins) => {
                const h = Math.floor(mins / 60);
                const m = mins % 60;
                if (h > 0 && m > 0) return `${h}Ø³ ${m}Ø¯`;
                if (h > 0) return `${h}Ø³`;
                return `${m}Ø¯`;
            };

            const sortedTasks = useMemo(() => [...tasks].sort((a, b) => a.startTime.localeCompare(b.startTime)), [tasks]);
            
            const stats = useMemo(() => {
                const data = {};
                let total = 0;
                tasks.forEach(t => {
                    const d = getDurationMins(t.startTime, t.endTime);
                    data[t.category] = (data[t.category] || 0) + d;
                    total += d;
                });
                return { data, total };
            }, [tasks]);

            // Handlers
            const handleSave = (e) => {
                e.preventDefault();
                const catId = formData.category || categories[0].id;
                if (currentTask) setTasks(tasks.map(t => t.id === currentTask.id ? { ...formData, category: catId, id: t.id } : t));
                else setTasks([...tasks, { ...formData, category: catId, id: generateId() }]);
                setIsModalOpen(false);
            };

            const openModal = (task = null) => {
                if (task) { setCurrentTask(task); setFormData(task); }
                else {
                    setCurrentTask(null);
                    let nextStart = sortedTasks.length > 0 ? sortedTasks[sortedTasks.length - 1].endTime : "09:00";
                    const [h, m] = nextStart.split(':').map(Number);
                    let endH = (h + 1) % 24;
                    setFormData({ title: '', startTime: nextStart, endTime: `${endH.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`, category: categories[0].id, notes: '' });
                }
                setIsModalOpen(true);
            };

            const handleClearAll = () => { if (confirm('Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) setTasks([]); };

            const generateTextSummary = () => {
                const date = new Date().toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' });
                let text = `ğŸ“… *Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…: ${date}*\n\n`;
                if(mainGoal) text += `ğŸ¯ *Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:* ${mainGoal}\n\n`;
                
                text += `ğŸ“‹ *Ø§Ù„Ù…Ù‡Ø§Ù…:*\n`;
                sortedTasks.forEach(t => {
                    const cat = categories.find(c => c.id === t.category)?.label || '';
                    const dur = formatDuration(getDurationMins(t.startTime, t.endTime));
                    text += `â€¢ ${formatTimeString(t.startTime)} - ${formatTimeString(t.endTime)} (${dur})\n`;
                    text += `  â”” ${t.title} [${cat}]${t.notes ? ` - ${t.notes}` : ''}\n`;
                });
                
                text += `\nğŸ“Š *Ù…Ù„Ø®Øµ Ø§Ù„ÙˆÙ‚Øª:* ${Math.floor(stats.total/60)}Ø³ ${stats.total%60}Ø¯\n`;
                return text;
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(generateTextSummary()).then(() => alert('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø©!'));
            };

            const exportJSON = () => {
                const data = JSON.stringify({ tasks, categories, mainGoal, theme: theme.id }, null, 2);
                const blob = new Blob([data], {type: 'application/json'});
                const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `MohammedIslam_Plan.json`; link.click();
            };

            const importJSON = () => {
                const input = document.createElement('input'); input.type = 'file'; input.accept = '.json';
                input.onchange = e => {
                    const reader = new FileReader();
                    reader.onload = event => { try { const json = JSON.parse(event.target.result); setTasks(json.tasks||[]); setCategories(json.categories||[]); setMainGoal(json.mainGoal||""); setTheme(THEMES.find(t=>t.id===json.theme)||THEMES[0]); alert('ØªÙ… Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©'); } catch(e){ alert('Ø®Ø·Ø£'); } };
                    reader.readAsText(e.target.files[0]);
                };
                input.click();
            };

            return (
                <div className={`min-h-screen flex flex-col ${darkMode ? 'bg-trueBlack text-slate-100' : 'bg-slate-100 text-slate-800'}`}>
                    <div className={`fixed top-0 left-0 w-full h-96 bg-gradient-to-b ${theme.primary} opacity-5 blur-3xl pointer-events-none`}></div>

                    <nav className={`sticky top-0 z-40 px-4 py-3 glass-panel border-b-0 no-print transition-all`}>
                        <div className="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-3">
                            <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-xl bg-gradient-to-br ${theme.primary} flex items-center justify-center text-white shadow-lg ${theme.shadow}`}>
                                    <Icon name="hourglass" size={20} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-black tracking-tight leading-none">TimePlanner</h1>
                                    <span className={`text-[9px] uppercase font-bold px-2 py-0.5 rounded-full bg-gradient-to-r ${theme.primary} text-white shadow-sm inline-block mt-0.5`}>Mohammed Islam edition</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => setShowThemes(!showThemes)} className={`p-2 rounded-xl transition-all ${showThemes ? 'bg-white text-black shadow-md' : 'hover:bg-slate-200/50 dark:hover:bg-white/10'}`}><Icon name="palette" size={18} /></button>
                                <div className="h-5 w-px bg-slate-300 dark:bg-slate-700 mx-1"></div>
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded-xl hover:bg-slate-200/50 dark:hover:bg-white/10">{darkMode ? <Icon name="sun" size={18} /> : <Icon name="moon" size={18} />}</button>
                                <button onClick={() => setIsSettingsOpen(true)} className="p-2 rounded-xl hover:bg-slate-200/50 dark:hover:bg-white/10"><Icon name="settings-2" size={18} /></button>
                                <button onClick={() => window.print()} className={`hidden md:flex items-center gap-2 px-4 py-2 rounded-xl font-bold text-white shadow-md bg-gradient-to-r ${theme.primary} hover:opacity-90 active:scale-95 transition-transform`}><Icon name="printer" size={16} /><span>PDF</span></button>
                            </div>
                        </div>
                        {showThemes && (
                            <div className="max-w-7xl mx-auto mt-3 animate-fade border-t border-slate-200/50 dark:border-white/10 pt-3 flex justify-center md:justify-start gap-3">
                                {THEMES.map(t => (
                                    <button key={t.id} onClick={() => setTheme(t)} title={t.name} className={`w-6 h-6 rounded-full bg-gradient-to-br ${t.primary} transition-all hover:scale-110 ${theme.id === t.id ? 'ring-2 ring-offset-2 ring-offset-white dark:ring-offset-black scale-110' : 'opacity-70'}`}></button>
                                ))}
                            </div>
                        )}
                    </nav>

                    <main className="flex-1 w-full max-w-7xl mx-auto p-4 lg:p-6 flex flex-col lg:flex-row gap-6 relative z-10">
                        <aside className="lg:w-[320px] space-y-5 print-break">
                            <div className={`p-5 rounded-3xl glass-panel shadow-sm relative overflow-hidden`}>
                                <div className={`absolute top-0 right-0 w-20 h-20 bg-gradient-to-br ${theme.primary} opacity-10 rounded-bl-full -mr-4 -mt-4`}></div>
                                <div className="relative z-10">
                                    <div className="flex items-center gap-2 mb-2 opacity-70"><Icon name="target" size={16} className={theme.accent} /><span className="text-xs font-bold uppercase tracking-wider">Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…</span></div>
                                    <textarea value={mainGoal} onChange={(e) => setMainGoal(e.target.value)} placeholder="Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…..." rows="2" className={`w-full bg-transparent text-lg font-bold resize-none outline-none placeholder-slate-300 dark:placeholder-slate-700`}></textarea>
                                </div>
                            </div>

                            <div className="p-5 rounded-3xl glass-panel shadow-sm">
                                <div className="flex justify-between items-end mb-4"><h3 className="font-bold">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª</h3><div className="text-xl font-black font-mono dir-ltr">{Math.floor(stats.total/60)}h {stats.total%60}m</div></div>
                                <div className="space-y-3">
                                    {categories.map(cat => {
                                        const mins = stats.data[cat.id] || 0;
                                        const percent = stats.total > 0 ? Math.round((mins/stats.total)*100) : 0;
                                        const style = CAT_STYLES[cat.styleIdx % CAT_STYLES.length];
                                        if (stats.total > 0 && mins === 0) return null;
                                        return (
                                            <div key={cat.id}>
                                                <div className="flex justify-between text-[11px] mb-1 font-medium"><span className="flex items-center gap-1.5"><Icon name={cat.icon} size={12} className={style.text}/> {cat.label}</span><span className="opacity-50">{formatDuration(mins)}</span></div>
                                                <div className="h-1.5 w-full bg-slate-100 dark:bg-white/5 rounded-full overflow-hidden"><div className={`h-full rounded-full ${theme.id === 'slate' ? 'bg-slate-600' : style.text.replace('text', 'bg')}`} style={{width: `${percent}%`}}></div></div>
                                            </div>
                                        );
                                    })}
                                    {stats.total === 0 && <p className="text-center text-xs opacity-40 py-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>}
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-2 no-print">
                                <button onClick={exportJSON} className="p-3 rounded-2xl glass-panel hover:bg-white dark:hover:bg-white/10 transition-colors flex items-center justify-center gap-2 text-xs font-bold opacity-70 hover:opacity-100"><Icon name="download" size={14} /> Ø­ÙØ¸ Ù†Ø³Ø®Ø©</button>
                                <button onClick={importJSON} className="p-3 rounded-2xl glass-panel hover:bg-white dark:hover:bg-white/10 transition-colors flex items-center justify-center gap-2 text-xs font-bold opacity-70 hover:opacity-100"><Icon name="upload" size={14} /> Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
                            </div>
                            <button onClick={() => openModal()} className={`w-full py-3.5 rounded-2xl bg-gradient-to-r ${theme.primary} text-white font-bold shadow-lg ${theme.shadow} flex items-center justify-center gap-2 active:scale-95 transition-transform no-print`}><Icon name="plus-circle" size={18} /> Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                        </aside>

                        <section className="flex-1 p-6 rounded-3xl glass-panel shadow-sm min-h-[600px] relative flex flex-col">
                            <header className="flex justify-between items-center mb-8 border-b border-slate-200/50 dark:border-white/10 pb-4">
                                <div><h2 className="text-xl font-bold mb-1">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</h2><p className="text-xs opacity-50">{currentTime.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p></div>
                                <div className="text-xs font-mono bg-slate-100 dark:bg-white/10 px-3 py-1 rounded-full opacity-60">{tasks.length} Tasks</div>
                            </header>

                            <div className="absolute right-[6rem] top-32 bottom-20 w-px bg-slate-200 dark:bg-white/10"></div>
                            <div className="space-y-6 relative flex-1">
                                {sortedTasks.map((task, idx) => {
                                    const cat = categories.find(c => c.id === task.category) || categories[0];
                                    const style = CAT_STYLES[cat.styleIdx % CAT_STYLES.length];
                                    const startT = formatTimeAMPM(task.startTime);
                                    const endT = formatTimeAMPM(task.endTime);
                                    const durationMins = getDurationMins(task.startTime, task.endTime);
                                    const overlap = idx > 0 && task.startTime < sortedTasks[idx-1].endTime;
                                    const crossesMidnight = task.endTime < task.startTime;

                                    return (
                                        <div key={task.id} onClick={() => openModal(task)} className="group flex gap-6 relative cursor-pointer animate-fade" style={{ animationDelay: `${idx * 0.03}s` }}>
                                            <div className="flex flex-col items-center min-w-[100px] text-right">
                                                <div className={`text-lg font-bold tracking-tight ${theme.accent} font-mono leading-none`}>{startT.time}<span className="text-[10px] ml-0.5">{startT.ampm}</span></div>
                                                <div className="mt-1 text-xs font-mono opacity-40 leading-none">{endT.time}<span className="text-[9px] ml-0.5">{endT.ampm}</span></div>
                                                <div className="text-[9px] font-medium opacity-30 mt-1">{formatDuration(durationMins)}</div>
                                                {overlap && <span className="mt-1 text-[8px] bg-red-500 text-white px-1 rounded animate-pulse">ØªØ¯Ø§Ø®Ù„</span>}
                                                {crossesMidnight && <span className="mt-1 text-[8px] bg-indigo-500 text-white px-1 rounded flex gap-0.5"><Icon name="moon" size={8}/> +1</span>}
                                            </div>
                                            <div className={`absolute right-[5.6rem] top-2 w-3 h-3 rounded-full border-2 border-white dark:border-slate-800 ${theme.id === 'slate' ? 'bg-slate-500' : style.text.replace('text', 'bg')} shadow-sm z-10 transition-transform group-hover:scale-125`}></div>
                                            <div className={`flex-1 p-4 rounded-2xl border-r-4 transition-all duration-200 group-hover:translate-x-[-3px] ${darkMode ? 'bg-white/5 hover:bg-white/10' : 'bg-white hover:bg-slate-50'} border-slate-100 dark:border-white/5 shadow-sm hover:shadow-md ${style.border}`}>
                                                <div>
                                                    <div className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[10px] font-bold mb-1 ${style.bg} ${style.text}`}><Icon name={cat.icon} size={10} /> {cat.label}</div>
                                                    <h3 className="font-bold text-lg leading-tight mb-1">{task.title}</h3>
                                                    {task.notes && <p className="text-xs opacity-60 leading-relaxed max-w-md">{task.notes}</p>}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                                {tasks.length === 0 && <div className="text-center py-24 opacity-30 flex flex-col items-center"><Icon name="layout-list" size={40} className="mb-3"/><p className="font-medium">Ø£Ø¶Ù Ù…Ù‡Ø§Ù…Ùƒ Ù„Ù„ÙŠÙˆÙ…</p></div>}
                            </div>

                            {/* Footer Buttons */}
                            {tasks.length > 0 && (
                                <div className="mt-10 pt-6 border-t border-slate-200/50 dark:border-white/10 flex justify-center gap-4 no-print">
                                    <button onClick={handleClearAll} className="text-red-400 hover:text-red-600 dark:hover:text-red-300 text-xs font-bold flex items-center gap-2 opacity-60 hover:opacity-100 transition-opacity bg-red-50 dark:bg-red-900/10 px-4 py-2 rounded-full">
                                        <Icon name="trash-2" size={14} /> Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                                    </button>
                                    <button onClick={() => setIsTxtModalOpen(true)} className="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-white text-xs font-bold flex items-center gap-2 opacity-60 hover:opacity-100 transition-opacity bg-slate-100 dark:bg-white/10 px-4 py-2 rounded-full">
                                        <Icon name="file-text" size={14} /> Txt Ù…Ù„Ø®Øµ
                                    </button>
                                </div>
                            )}
                        </section>
                    </main>

                    {/* Task Modal */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-pop no-print">
                            <div className={`w-full max-w-lg rounded-3xl shadow-2xl p-6 relative overflow-hidden ${darkMode ? 'bg-darkCard text-white' : 'bg-white text-slate-900'}`}>
                                <div className={`absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r ${theme.primary}`}></div>
                                <div className="flex justify-between items-center mb-6"><h3 className="text-xl font-bold">{currentTask ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Ø¥Ø¶Ø§ÙØ©'}</h3><button onClick={() => setIsModalOpen(false)} className="opacity-50 hover:opacity-100"><Icon name="x" /></button></div>
                                <form onSubmit={handleSave} className="space-y-5">
                                    <div><label className="text-xs font-bold opacity-50 uppercase mb-1.5 block">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input required autoFocus value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} className={`w-full p-3.5 rounded-2xl bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 outline-none focus:ring-2 ${theme.ring}`} /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold opacity-50 uppercase mb-1.5 block">Ù…Ù†</label><input type="time" required value={formData.startTime} onChange={e => setFormData({...formData, startTime: e.target.value})} className={`w-full p-3.5 rounded-2xl bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 outline-none focus:ring-2 ${theme.ring}`} /></div>
                                        <div><label className="text-xs font-bold opacity-50 uppercase mb-1.5 block">Ø¥Ù„Ù‰</label><input type="time" required value={formData.endTime} onChange={e => setFormData({...formData, endTime: e.target.value})} className={`w-full p-3.5 rounded-2xl bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 outline-none focus:ring-2 ${theme.ring}`} /></div>
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold opacity-50 uppercase mb-1.5 block">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                                        <div className="grid grid-cols-3 gap-2">{categories.map(cat => <button type="button" key={cat.id} onClick={() => setFormData({...formData, category: cat.id})} className={`p-2.5 rounded-xl border text-xs font-bold flex flex-col items-center gap-1 transition-all ${formData.category === cat.id ? `bg-gradient-to-br ${theme.primary} text-white border-transparent shadow-sm` : `border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/5`}`}><Icon name={cat.icon} size={16} /> {cat.label}</button>)}</div>
                                    </div>
                                    <div><label className="text-xs font-bold opacity-50 uppercase mb-1.5 block">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})} className={`w-full p-3.5 rounded-2xl bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 outline-none focus:ring-2 ${theme.ring}`} rows="2"></textarea></div>
                                    <div className="flex gap-3 pt-2">{currentTask && <button type="button" onClick={() => { setTasks(tasks.filter(t => t.id !== currentTask.id)); setIsModalOpen(false); }} className="p-3.5 rounded-xl text-red-500 bg-red-500/10 hover:bg-red-500/20"><Icon name="trash-2" /></button>}<button type="submit" className={`flex-1 py-3.5 rounded-xl text-white font-bold shadow-lg bg-gradient-to-r ${theme.primary} hover:opacity-90 transition-all`}>Ø­ÙØ¸</button></div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Text Summary Modal */}
                    {isTxtModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-pop no-print">
                            <div className={`w-full max-w-lg rounded-3xl shadow-2xl p-6 relative flex flex-col max-h-[85vh] ${darkMode ? 'bg-darkCard text-white' : 'bg-white text-slate-900'}`}>
                                <div className="flex justify-between items-center mb-4 border-b border-slate-200/50 dark:border-white/10 pb-4">
                                    <h3 className="font-bold text-lg flex items-center gap-2"><Icon name="file-text" size={20}/> Ù…Ù„Ø®Øµ Ù†ØµÙŠ</h3>
                                    <button onClick={() => setIsTxtModalOpen(false)}><Icon name="x" /></button>
                                </div>
                                <div className="flex-1 overflow-hidden relative rounded-xl border border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-black/30">
                                    <textarea readOnly value={generateTextSummary()} className="w-full h-full p-4 bg-transparent resize-none outline-none text-sm font-mono leading-relaxed custom-scroll"></textarea>
                                </div>
                                <button onClick={copyToClipboard} className={`w-full mt-4 py-3 rounded-xl font-bold text-white shadow-lg bg-gradient-to-r ${theme.primary} flex items-center justify-center gap-2`}>
                                    <Icon name="copy" size={18} /> Ù†Ø³Ø® Ù„Ù„Ù†Øµ
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Settings Modal */}
                    {isSettingsOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-pop no-print">
                            <div className={`w-full max-w-lg rounded-3xl shadow-2xl flex flex-col max-h-[80vh] ${darkMode ? 'bg-darkCard text-white' : 'bg-white text-slate-900'}`}>
                                <div className="p-5 border-b border-slate-100 dark:border-white/10 flex justify-between items-center"><h3 className="font-bold text-lg">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h3><button onClick={() => setIsSettingsOpen(false)}><Icon name="x" /></button></div>
                                <div className="flex-1 overflow-y-auto p-5 space-y-3 custom-scroll">
                                    {categories.map(cat => (
                                        <div key={cat.id} className={`flex justify-between items-center p-3 rounded-2xl ${darkMode ? 'bg-black/20' : 'bg-slate-50'}`}>
                                            <div className="flex items-center gap-3"><div className={`w-8 h-8 rounded-lg flex items-center justify-center ${CAT_STYLES[cat.styleIdx % CAT_STYLES.length].bg} ${CAT_STYLES[cat.styleIdx % CAT_STYLES.length].text}`}><Icon name={cat.icon} size={16}/></div><span className="font-bold">{cat.label}</span></div>
                                            <button onClick={() => { if(categories.length > 1) setCategories(categories.filter(c => c.id !== cat.id)); else alert('ÙŠØ¬Ø¨ Ø¨Ù‚Ø§Ø¡ ØªØµÙ†ÙŠÙ ÙˆØ§Ø­Ø¯'); }} className="text-red-500 opacity-50 hover:opacity-100 p-2"><Icon name="trash-2" size={16}/></button>
                                        </div>
                                    ))}
                                    <div className={`p-4 rounded-2xl border-2 border-dashed ${darkMode ? 'border-white/10 bg-white/5' : 'border-slate-200 bg-slate-50/50'} mt-4`}>
                                        <CategoryForm addCategory={(newCat) => setCategories([...categories, { ...newCat, id: generateId() }])} theme={theme} darkMode={darkMode}/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const CategoryForm = ({ addCategory, theme, darkMode }) => {
            const [newCat, setNewCat] = useState({ label: '', styleIdx: 0, icon: 'circle' });
            return (
                <>
                    <input value={newCat.label} onChange={e => setNewCat({...newCat, label: e.target.value})} placeholder="Ø§Ù„Ø§Ø³Ù…..." className={`w-full p-2 mb-3 rounded-lg bg-transparent border ${darkMode ? 'border-white/20' : 'border-slate-300'}`} />
                    <div className="flex gap-2 mb-3">{CAT_STYLES.map((s, i) => <button key={i} onClick={() => setNewCat({...newCat, styleIdx: i})} className={`w-6 h-6 rounded-full ${s.bg} border-2 ${newCat.styleIdx === i ? `border-current ${s.text}` : 'border-transparent'}`}></button>)}</div>
                    <div className="flex gap-2 mb-3 overflow-x-auto pb-2">{ICONS.map(ic => <button key={ic} onClick={() => setNewCat({...newCat, icon: ic})} className={`p-1.5 rounded-lg border ${newCat.icon === ic ? `bg-slate-800 text-white dark:bg-white dark:text-black border-transparent` : `border-transparent hover:bg-slate-200 dark:hover:bg-white/10`}`}><Icon name={ic} size={16}/></button>)}</div>
                    <button onClick={() => { if(newCat.label) { addCategory(newCat); setNewCat({label:'', styleIdx:0, icon:'circle'}); }}} className={`w-full py-2 rounded-lg font-bold text-white shadow bg-gradient-to-r ${theme.primary}`}>Ø¥Ø¶Ø§ÙØ©</button>
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


